<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HackMatch - Find Your Team</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/framer-motion@11.0.0/dist/framer-motion.js"></script>
    
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap');

        @keyframes gradient-xy {
            0%, 100% {
                background-size: 400% 400%;
                background-position: 0% 50%;
            }
            50% {
                background-size: 200% 200%;
                background-position: 100% 50%;
            }
        }
        .animate-gradient-xy {
            background: linear-gradient(-45deg, #1e1b4b, #4c1d95, #1e40af, #3b0764);
            animation: gradient-xy 15s ease infinite;
        }
        .animate-ping-slow {
            animation: ping 2s cubic-bezier(0, 0, 0.2, 1) infinite;
        }
    </style>
</head>
<body class="bg-gray-900">
    <div id="root"></div>

    <script type="text/babel">
        // De-structure dependencies from their global objects
        const { useState, useEffect, useMemo, useRef, useCallback } = React;
        
        // Debug: Check what's available
        console.log('React available:', !!React);
        console.log('ReactDOM available:', !!ReactDOM);
        console.log('FramerMotion available:', !!window.framerMotion);
        console.log('Babel available:', !!window.Babel);
        
        // Framer Motion fallback - create simple motion components if not available
        let motion, AnimatePresence, useMotionValue, useTransform;
        
        if (window.framerMotion) {
            ({ motion, AnimatePresence, useMotionValue, useTransform } = window.framerMotion);
            console.log('Using Framer Motion');
        } else {
            console.log('Using fallback motion components');
            // Fallback motion components - create all necessary motion elements
            const createMotionElement = (elementType) => ({ children, ...props }) => {
                // Remove motion-specific props that don't exist on regular HTML elements
                const { initial, animate, exit, variants, custom, whileHover, whileTap, whileDrag, drag, dragConstraints, onDragEnd, style, transition, ...htmlProps } = props;
                return React.createElement(elementType, htmlProps, children);
            };
            
            motion = {
                div: createMotionElement('div'),
                button: createMotionElement('button'),
                span: createMotionElement('span'),
                h1: createMotionElement('h1'),
                h2: createMotionElement('h2'),
                h3: createMotionElement('h3'),
                h4: createMotionElement('h4'),
                h5: createMotionElement('h5'),
                h6: createMotionElement('h6'),
                p: createMotionElement('p'),
                form: createMotionElement('form'),
                input: createMotionElement('input'),
                img: createMotionElement('img'),
                section: createMotionElement('section'),
                article: createMotionElement('article'),
                header: createMotionElement('header'),
                footer: createMotionElement('footer'),
                nav: createMotionElement('nav'),
                main: createMotionElement('main'),
                aside: createMotionElement('aside'),
                ul: createMotionElement('ul'),
                li: createMotionElement('li'),
                a: createMotionElement('a')
            };
            AnimatePresence = ({ children }) => children;
            useMotionValue = (initial) => React.useRef(initial);
            useTransform = (value, input, output) => value;
        }

        // --- ICONS (Self-contained SVG components) ---
        const HomeIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" /><polyline points="9 22 9 12 15 12 15 22" /></svg>;
        const UsersIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2" /><circle cx="9" cy="7" r="4" /><path d="M22 21v-2a4 4 0 0 0-3-3.87" /><path d="M16 3.13a4 4 0 0 1 0 7.75" /></svg>;
        const MessageIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M7.9 20A9.9 9.9 0 1 0 4 16.1L2 22Z" /></svg>;
        const UserProfileIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2" /><circle cx="12" cy="7" r="4" /></svg>;
        const PlusIcon = () => <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v16m8-8H4" /></svg>;
        const XIcon = () => <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" /></svg>;
        const PaperAirplaneIcon = () => <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path d="M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 001.169 1.409l5-1.429A1 1 0 009 15.571V11a1 1 0 112 0v4.571a1 1 0 00.725.962l5 1.428a1 1 0 001.17-1.408l-7-14z" /></svg>;
        const ViewBoardsIcon = () => <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 17V7m0 10a2 2 0 01-2 2H5a2 2 0 01-2-2V7a2 2 0 012-2h2a2 2 0 012 2m0 10a2 2 0 002 2h2a2 2 0 002-2M9 7a2 2 0 012-2h2a2 2 0 012 2m0 10V7m0 10a2 2 0 002 2h2a2 2 0 002-2V7a2 2 0 00-2-2h-2a2 2 0 00-2 2" /></svg>;
        const ChatAlt2Icon = () => <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17 8h2a2 2 0 012 2v6a2 2 0 01-2 2h-2v4l-4-4H9a2 2 0 01-2-2V7a2 2 0 012-2h2m6-4a2 2 0 00-2-2H9a2 2 0 00-2 2v10a2 2 0 002 2h1" /></svg>;
        const ShieldIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z" /></svg>;
        const AwardIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="8" r="7"/><polyline points="8.21 13.89 7 23 12 17 17 23 15.79 13.88"/></svg>;
        const UserPlusIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><line x1="19" x2="19" y1="8" y2="14"/><line x1="22" x2="16" y1="11" y2="11"/></svg>;
        const CalendarIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>;
        const StarIcon = ({ filled, className }) => (<svg xmlns="http://www.w3.org/2000/svg" className={`h-5 w-5 ${className}`} viewBox="0 0 20 20" fill={filled ? "currentColor" : "none"} stroke="currentColor" strokeWidth="1.5"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" /></svg>);
        const ChevronLeftIcon = ({ className = "h-8 w-8" }) => <svg xmlns="http://www.w3.org/2000/svg" className={className} fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 19l-7-7 7-7" /></svg>;
        const ChevronRightIcon = ({ className = "h-8 w-8" }) => <svg xmlns="http://www.w3.org/2000/svg" className={className} fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 5l7 7-7 7" /></svg>;


        // --- MOCK DATA GENERATION ---
        const CURRENT_USER_ID = 'user1';
        const names = ['Alex Johnson', 'Maria Garcia', 'Chen Wei', 'Fatima Al-Fassi', 'Sam Taylor', 'Priya Singh', 'John Smith', 'Emily White', 'Daniel Kim', 'Sophia Rodriguez', 'Leo Carter', 'Ava Nguyen', 'Mason Williams', 'Isabella Brown', 'Ethan Jones', 'Mia Davis', 'Liam Miller', 'Charlotte Wilson', 'Noah Moore', 'Amelia Martin'];
        const roles = ['Junior Developer', 'Senior Developer', 'UI/UX Designer', 'Product Manager', 'Data Scientist', 'DevOps Engineer', 'Mentor', 'Lead Engineer', 'QA Engineer', 'Frontend Developer', 'Backend Developer'];
        const skills = ['React', 'Python', 'Figma', 'AI/ML', 'Blockchain', 'Node.js', 'Go', 'Kubernetes', 'Swift', 'Kotlin', 'AWS', 'GCP', 'Solidity', 'Rust', 'TypeScript', 'Java', 'C++', 'Vue.js'];
        const themes = ['HealthTech', 'AR/VR', 'Social Good', 'FinTech', 'Climate', 'Education', 'Gaming', 'Web3', 'Cybersecurity', 'Developer Tools', 'E-commerce', 'MusicTech'];
        const statuses = ['Seeking Mentor', 'Looking for Team', 'Open to Ideas', 'Building a Team'];
        const bios = ["Passionate developer with a love for clean code and creative problem-solving.", "Designer focused on creating beautiful, intuitive, and user-centered interfaces.", "Data enthusiast who enjoys finding stories hidden in complex datasets.", "Product leader dedicated to building impactful products that users love.", "Cloud architect specializing in scalable and resilient infrastructure."];
        const reviewQuotes = ["An amazing collaborator, full of great ideas!", "Incredibly skilled and a pleasure to work with.", "Always willing to help out and explain complex topics.", "Brings so much positive energy to the team.", "A true leader who elevates everyone's work.", "Very sharp, and quick to find solutions."];
        const highQualityAvatars = [ 'https://images.unsplash.com/photo-1573496359142-b8d8J7734a5a2?q=80&w=400&auto=format&fit=crop', 'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?q=80&w=400&auto=format&fit=crop', 'https://images.unsplash.com/photo-1494790108377-be9c29b29330?q=80&w=400&auto=format&fit=crop', 'https://images.unsplash.com/photo-1564564321837-a57b7070ac4f?q=80&w=400&auto=format&fit=crop', 'https://images.unsplash.com/photo-1488426862026-3ee34a7d66df?q=80&w=400&auto=format&fit=crop', 'https://images.unsplash.com/photo-1557862921-37829c790f19?q=80&w=400&auto=format&fit=crop', 'https://images.unsplash.com/photo-1534528741775-53994a69daeb?q=80&w=400&auto=format&fit=crop', 'https://images.unsplash.com/photo-1599566150163-29194dcaad36?q=80&w=400&auto=format&fit=crop', 'https://images.unsplash.com/photo-1568602471122-7832951cc4c5?q=80&w=400&auto=format&fit=crop', 'https://images.unsplash.com/photo-1583864697784-a0efc8379f70?q=80&w=400&auto=format&fit=crop', 'https://images.unsplash.com/photo-1519085360753-af0119f7cbe7?q=80&w=400&auto=format&fit=crop', 'https://images.unsplash.com/photo-1522075469751-3a6694fb2f61?q=80&w=400&auto=format&fit=crop', 'https://images.unsplash.com/photo-1500648767791-00dcc994a43e?q=80&w=400&auto=format&fit=crop', 'https://images.unsplash.com/photo-1508214751196-bcfd4ca60f91?q=80&w=400&auto=format&fit=crop', 'https://images.unsplash.com/photo-1523824921871-d6f1a15141f1?q=80&w=400&auto=format&fit=crop', 'https://images.unsplash.com/photo-1537511446984-935f663eb1f4?q=80&w=400&auto=format&fit=crop', 'https://images.unsplash.com/photo-1619895862022-09114b41f16f?q=80&w=400&auto=format&fit=crop', 'https://images.unsplash.com/photo-1555952517-2e8e729e0b44?q=80&w=400&auto=format&fit=crop', 'https://images.unsplash.com/photo-1600486913747-55e5470d6f40?q=80&w=400&auto=format&fit=crop', 'https://images.unsplash.com/photo-1566753323558-f4e0952af115?q=80&w=400&auto=format&fit=crop', 'https://images.unsplash.com/photo-1590086782792-42dd2350140d?q=80&w=400&auto=format&fit=crop', 'https://images.unsplash.com/photo-1560250097-0b93528c311a?q=80&w=400&auto=format&fit=crop', 'https://images.unsplash.com/photo-1530268729831-4b0b9e170218?q=80&w=400&auto=format&fit=crop', 'https://images.unsplash.com/photo-1543132789-23203f503d22?q=80&w=400&auto=format&fit=crop', 'https://images.unsplash.com/photo-1531891437562-b1a2153a8174?q=80&w=400&auto=format&fit=crop', 'https://images.unsplash.com/photo-1509460913899-515f1dfaa43c?q=80&w=400&auto=format&fit=crop', 'https://images.unsplash.com/photo-1581382575275-97901c2635b7?q=80&w=400&auto=format&fit=crop', 'https://images.unsplash.com/photo-1624298357597-fd92dfbec01d?q=80&w=400&auto=format&fit=crop', 'https://images.unsplash.com/photo-1615109398623-88346a601842?q=80&w=400&auto=format&fit=crop', 'https://images.unsplash.com/photo-1549068106-b1a4fa4d74ce?q=80&w=400&auto=format&fit=crop'];

        const generateSingleMockProfile = (id) => {
            const experienceLevels = ['Junior', 'Mid-level', 'Senior', 'Lead'];
            return {
                id: `user${id}`,
                name: names[Math.floor(Math.random() * names.length)],
                role: roles[Math.floor(Math.random() * roles.length)],
                experienceLevel: experienceLevels[Math.floor(Math.random() * experienceLevels.length)],
                avatar: highQualityAvatars[Math.floor(Math.random() * highQualityAvatars.length)],
                skills: [...new Set(Array.from({ length: Math.floor(Math.random() * 4) + 3 }, () => skills[Math.floor(Math.random() * skills.length)]))],
                hackathonThemes: [...new Set(Array.from({ length: Math.floor(Math.random() * 3) + 2 }, () => themes[Math.floor(Math.random() * themes.length)]))],
                matchPercentage: Math.floor(Math.random() * 30) + 70,
                status: statuses[Math.floor(Math.random() * statuses.length)],
                bio: bios[Math.floor(Math.random() * bios.length)],
                teamId: null,
                badges: [],
                openToBeginners: Math.random() > 0.5,
                lookingForMentor: Math.random() > 0.7,
                reviews: Array.from({ length: Math.floor(Math.random() * 5) + 3 }).map(() => ({
                    reviewerName: names[Math.floor(Math.random() * names.length)],
                    rating: parseFloat((Math.random() * 1.5 + 3.5).toFixed(1)),
                    quote: reviewQuotes[Math.floor(Math.random() * reviewQuotes.length)],
                })),
            };
        };


        const generateMockProfiles = (count) => {
            const profiles = {};
            for (let i = 0; i < count; i++) {
                const userId = i + 2; // Start from user2 to avoid conflicts
                profiles[`user${userId}`] = generateSingleMockProfile(userId);
            }
            return profiles;
        };

        const mockUsers = {
            'user1': { 
                name: 'You (Admin)', 
                avatar: 'https://images.unsplash.com/photo-1573496359142-b8d87734a5a2?q=80&w=400&auto=format&fit=crop', 
                experienceLevel: 'Senior', 
                skills: ['React', 'Node.js', 'GraphQL'], 
                bio: "Lead frontend dev with a passion for building scalable and intuitive user interfaces.", 
                hackathonThemes: ['AI', 'Developer Tools', 'Productivity'], 
                teamId: 'team14', 
                openToBeginners: true, 
                lookingForMentor: false, 
                badges: ['Team Builder'],
                reviews: [
                    { reviewerName: 'Alex Johnson', rating: 4.8, quote: "A fantastic leader and mentor. I learned so much from working with them." },
                    { reviewerName: 'Maria Garcia', rating: 5.0, quote: "Always brings top-tier skills and a positive attitude. Highly recommend!" },
                ] 
            },
            ...generateMockProfiles(100)
        };


        const badgeDetails = {
            'Quick Match': { description: 'Awarded for making your first 3 matches.', icon: <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z"/><line x1="4" y1="22" x2="4" y2="15"/></svg>, color: "text-purple-400" },
            'Mentor Hero': { description: 'Awarded for mentoring a beginner on a team.', icon: <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m12 14 4-4"/><path d="M3.34 19a10 10 0 1 1 17.32 0"/><path d="M12 22V12"/></svg>, color: "text-blue-400" },
            'Team Builder': { description: 'Awarded for creating or joining 2 hackathons.', icon: <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>, color: "text-green-400" },
            'Collab Champ': { description: 'Awarded for being an active team member.', icon: <AwardIcon />, color: "text-yellow-400" },
        };

        const allMockUsers = Object.entries(mockUsers).map(([id, data]) => ({ id, ...data }));
        let smartMatchesMock = allMockUsers.filter(u => u.id !== CURRENT_USER_ID).map(u => ({...u, compatibilityScore: Math.floor(Math.random() * 30) + 70}));

        const mockTeams = {
            'team1': { name: 'AI Avengers', members: ['user2', 'user3', 'user5'] },
            'team2': { name: 'Firebase Fanatics', members: ['user4', 'user6'] },
            'team14': { name: 'The Final Frontiers', members: ['user1', 'user58', 'user59']}
        }; 

        const mockUpcomingHackathons = [
            { name: 'AI for Good Global Summit', date: 'Oct 10-12, 2025', theme: 'AI & Social Good', url: '#' },
            { name: 'Web3 Weekend Warriors', date: 'Oct 18, 2025', theme: 'Blockchain & DeFi', url: '#' },
            { name: 'GameDev Gauntlet', date: 'Nov 1-3, 2025', theme: 'Gaming & AR/VR', url: '#' },
        ];

        // --- SIMULATED REACT HOOKS ---
        const useSmartMatches = () => {
            const [matches, setMatches] = useState([]);
            const [loading, setLoading] = useState(true);
            useEffect(() => {
                setTimeout(() => {
                    const currentUser = mockUsers[CURRENT_USER_ID];
                    const isBeginner = currentUser.experienceLevel === 'Junior';
                    const isSeekingMentor = currentUser.lookingForMentor;

                    const sortedMatches = [...smartMatchesMock]
                        .filter(m => !m.teamId) 
                        .sort((a, b) => {
                            let scoreA = a.compatibilityScore;
                            let scoreB = b.compatibilityScore;
                            if (isBeginner || isSeekingMentor) {
                                if (a.openToBeginners || ['Senior', 'Lead'].includes(a.experienceLevel)) scoreA += 25;
                                if (b.openToBeginners || ['Senior', 'Lead'].includes(b.experienceLevel)) scoreB += 25;
                            }
                            if (a.openToBeginners) scoreA += 5;
                            if (b.openToBeginners) scoreB += 5;

                            const themesA = a.hackathonThemes || [];
                            const themesB = b.hackathonThemes || [];
                            const currentUserThemes = currentUser.hackathonThemes || [];

                            const sharedThemesA = themesA.filter(theme => currentUserThemes.includes(theme)).length;
                            const sharedThemesB = themesB.filter(theme => currentUserThemes.includes(theme)).length;
                            scoreA += sharedThemesA * 5;
                            scoreB += sharedThemesB * 5;
                            return scoreB - scoreA;
                        });
                    setMatches(sortedMatches);
                    setLoading(false);
                }, 1500);
            }, []);
            return { matches, loading };
        };

        // --- HELPER FUNCTIONS ---
        const getChatDetails = (chat, userId) => {
            if (!chat) return { name: 'Invalid Chat', avatar: null };
            
            if (chat.type === 'community') {
                return { name: chat.name, avatar: <div className="h-12 w-12 rounded-full bg-purple-500/30 flex items-center justify-center"><UsersIcon /></div> };
            }

            if (chat.type === 'private') {
                const otherUserId = chat.members.find(id => id !== userId);
                const otherUser = mockUsers[otherUserId];
                if (!otherUser) return { name: 'Unknown User', avatar: null };
                return { name: otherUser.name, avatar: <img src={otherUser.avatar} alt={otherUser.name} className="h-12 w-12 rounded-full" /> };
            }

            if (chat.type === 'team' && chat.members) {
                const otherMembers = chat.members.filter(id => id !== userId);
                return { name: chat.teamName, avatar: (<div className="relative h-12 w-12">{otherMembers.slice(0, 3).map((memId, index) => (<img key={memId} src={mockUsers[memId]?.avatar || ''} alt="" className={`h-7 w-7 rounded-full absolute border-2 border-gray-700 ${index === 0 ? 'top-0 left-0' : index === 1 ? 'bottom-0 left-2' : 'top-0 right-0'}`} />))}</div>) };
            }

            return { name: 'Invalid Chat', avatar: null };
        };

        // --- CHILD COMPONENTS ---
        const StarRating = ({ rating }) => {
            return (
                <div className="flex items-center">
                    {[...Array(5)].map((_, index) => (
                        <StarIcon key={index} filled={index < Math.round(rating)} className={index < Math.round(rating) ? 'text-yellow-400' : 'text-gray-600'} />
                    ))}
                </div>
            );
        };
        const ConfettiPiece = ({ x, y, rotate, color }) => (<motion.div style={{ position: 'absolute', left: `${x}vw`, top: `-20px`, backgroundColor: color, width: '10px', height: '10px', borderRadius: '50%', }} animate={{ y: '100vh', x: [null, `${x + (Math.random() - 0.5) * 10}vw`], rotate: rotate + 360, }} transition={{ duration: 3 + Math.random() * 2, ease: "linear", repeat: 0 }} />);
        const ConfettiExplosion = () => { const colors = ["#8B5CF6", "#EC4899", "#10B981", "#3B82F6", "#F59E0B"]; const pieces = useMemo(() => Array.from({ length: 100 }).map((_, i) => ({ id: i, x: Math.random() * 100, y: Math.random() * 100, rotate: Math.random() * 360, color: colors[i % colors.length], })), []); return (<div className="fixed inset-0 pointer-events-none z-50">{pieces.map(p => <ConfettiPiece key={p.id} {...p} />)}</div>); };
        const BadgeToast = ({ badgeName }) => { const details = badgeDetails[badgeName]; return (<motion.div initial={{ opacity: 0, y: 50 }} animate={{ opacity: 1, y: 0 }} exit={{ opacity: 0, y: 20 }} className="fixed bottom-24 left-1/2 -translate-x-1/2 p-4 bg-gray-800 border border-yellow-400 text-white rounded-xl shadow-2xl z-50 flex items-center space-x-4"><div className={`w-12 h-12 ${details.color} flex-shrink-0`}>{details.icon}</div><div><p className="font-bold text-lg">Badge Unlocked!</p><p className="text-yellow-300">{badgeName}</p></div></motion.div>); };
        const SwipeableCard = ({ profile, onSwipe }) => {
            const [dragOffset, setDragOffset] = useState(0);
            const [isDragging, setIsDragging] = useState(false);
            const [imageLoaded, setImageLoaded] = useState(false);
            const currentDragOffset = useRef(0);
            
            // Reset drag state when profile changes
            useEffect(() => {
                setDragOffset(0);
                setIsDragging(false);
                currentDragOffset.current = 0;
                // Don't reset imageLoaded - let it load naturally
            }, [profile.id]);
            
            // Cleanup event listeners on unmount
            useEffect(() => {
                return () => {
                    // Clean up any remaining event listeners
                    document.removeEventListener('mousemove', () => {});
                    document.removeEventListener('mouseup', () => {});
                    document.removeEventListener('touchmove', () => {});
                    document.removeEventListener('touchend', () => {});
                };
            }, []);
            
            const handleMouseDown = (e) => {
                e.preventDefault();
                setIsDragging(true);
                const startX = e.clientX;
                
                const handleMouseMove = (e) => {
                    const deltaX = e.clientX - startX;
                    currentDragOffset.current = deltaX;
                    setDragOffset(deltaX);
                };
                
                const handleMouseUp = () => {
                    setIsDragging(false);
                    const currentOffset = currentDragOffset.current;
                    if (currentOffset > 80) {
                        onSwipe('accept', profile.id);
                    } else if (currentOffset < -80) {
                        onSwipe('reject', profile.id);
                    } else {
                        // Smooth transition back to center
                        setDragOffset(0);
                        currentDragOffset.current = 0;
                    }
                    document.removeEventListener('mousemove', handleMouseMove);
                    document.removeEventListener('mouseup', handleMouseUp);
                };
                
                document.addEventListener('mousemove', handleMouseMove);
                document.addEventListener('mouseup', handleMouseUp);
            };
            
            const handleTouchStart = (e) => {
                e.preventDefault();
                setIsDragging(true);
                const startX = e.touches[0].clientX;
                
                const handleTouchMove = (e) => {
                    e.preventDefault();
                    const deltaX = e.touches[0].clientX - startX;
                    currentDragOffset.current = deltaX;
                    setDragOffset(deltaX);
                };
                
                const handleTouchEnd = (e) => {
                    e.preventDefault();
                    setIsDragging(false);
                    const currentOffset = currentDragOffset.current;
                    if (currentOffset > 80) {
                        onSwipe('accept', profile.id);
                    } else if (currentOffset < -80) {
                        onSwipe('reject', profile.id);
                    } else {
                        // Smooth transition back to center
                        setDragOffset(0);
                        currentDragOffset.current = 0;
                    }
                    document.removeEventListener('touchmove', handleTouchMove);
                    document.removeEventListener('touchend', handleTouchEnd);
                };
                
                document.addEventListener('touchmove', handleTouchMove, { passive: false });
                document.addEventListener('touchend', handleTouchEnd);
            };

            const rotate = Math.min(Math.max(dragOffset / 6, -20), 20);
            const likeOpacity = Math.max(0, Math.min(1, (dragOffset - 50) / 70));
            const nopeOpacity = Math.max(0, Math.min(1, (-dragOffset - 50) / 70));

            // Fallback avatar if image fails to load
            const getAvatarUrl = (originalUrl) => {
                if (!originalUrl) return 'https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?q=80&w=400&auto=format&fit=crop';
                return originalUrl;
            };

            return (
                <div 
                    onMouseDown={handleMouseDown}
                    onTouchStart={handleTouchStart}
                    style={{ 
                        transform: `translateX(${dragOffset}px) rotate(${rotate}deg)`,
                        transition: isDragging ? 'none' : 'transform 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94)'
                    }}
                    className="bg-white/5 backdrop-blur-xl border border-white/10 rounded-2xl shadow-2xl cursor-grab active:cursor-grabbing w-full h-full select-none overflow-hidden"
                >
                    <div className="relative w-full h-full">
                        {/* Match Percentage Badge */}
                        <div className="absolute top-4 right-4 z-20 bg-white/90 text-gray-800 font-bold text-sm px-3 py-1 rounded-full shadow-lg">
                            {profile.matchPercentage}% Match
                        </div>
                        
                        {/* Status Badge */}
                        {profile.openToBeginners && (
                            <div className="absolute top-4 left-4 z-20 bg-green-500/90 text-white px-3 py-1 text-xs font-bold rounded-full">
                                BEGINNER-FRIENDLY
                            </div>
                        )}
                        
                        {/* Profile Image */}
                        <div className="relative w-full h-3/5 overflow-hidden">
                            <img 
                                src={getAvatarUrl(profile.avatar)} 
                                alt={profile.name}
                                onLoad={() => setImageLoaded(true)}
                                onError={() => setImageLoaded(false)}
                                className={`w-full h-full object-cover transition-opacity duration-500 ${imageLoaded ? 'opacity-100' : 'opacity-0'}`}
                                draggable="false" 
                            />
                            <div className={`absolute inset-0 bg-gradient-to-br from-purple-500 to-blue-600 flex items-center justify-center transition-opacity duration-500 ${imageLoaded ? 'opacity-0' : 'opacity-100'}`}>
                                <div className="text-white text-6xl font-bold">
                                    {profile.name.charAt(0)}
                                </div>
                            </div>
                            
                            {/* Swipe Indicators */}
                            <div 
                                style={{ opacity: likeOpacity }} 
                                className="absolute top-8 right-8 text-green-400 border-4 border-green-400 p-4 rounded-2xl font-black text-3xl transform -rotate-12 bg-black/60 backdrop-blur-sm shadow-lg"
                            >
                                ✓ COMPILE
                            </div>
                            <div 
                                style={{ opacity: nopeOpacity }} 
                                className="absolute top-8 left-8 text-red-400 border-4 border-red-400 p-4 rounded-2xl font-black text-3xl transform rotate-12 bg-black/60 backdrop-blur-sm shadow-lg"
                            >
                                ✗ BUG
                            </div>
                        </div>
                        
                        {/* Profile Info */}
                        <div className="absolute bottom-0 left-0 right-0 p-6 bg-gradient-to-t from-black/90 via-black/70 to-transparent">
                            {/* Name */}
                            <h2 className="text-3xl font-bold text-white mb-2">{profile.name}</h2>
                            
                            {/* Bio */}
                            <p className="text-gray-200 mb-4 text-sm">{profile.bio}</p>
                            
                            {/* Skills */}
                            <div className="mb-4">
                                <p className="text-gray-300 text-sm font-semibold mb-2">Skills:</p>
                                <div className="flex flex-wrap gap-2">
                                    {profile.skills.slice(0, 3).map(skill => (
                                        <span key={skill} className="bg-indigo-500/80 text-white px-3 py-1 text-sm rounded-full">
                                            {skill}
                                        </span>
                                    ))}
                                    {profile.skills.length > 3 && (
                                        <span className="bg-gray-500/80 text-white px-3 py-1 text-sm rounded-full">
                                            +{profile.skills.length - 3}
                                        </span>
                                    )}
                                </div>
                            </div>
                            
                            {/* Themes */}
                            <div className="mb-4">
                                <p className="text-gray-300 text-sm font-semibold mb-2">Themes:</p>
                                <div className="flex flex-wrap gap-2">
                                    {profile.hackathonThemes.slice(0, 3).map(theme => (
                                        <span key={theme} className="bg-teal-500/80 text-white px-3 py-1 text-sm rounded-full">
                                            {theme}
                                        </span>
                                    ))}
                                    {profile.hackathonThemes.length > 3 && (
                                        <span className="bg-gray-500/80 text-white px-3 py-1 text-sm rounded-full">
                                            +{profile.hackathonThemes.length - 3}
                                        </span>
                                    )}
                                </div>
                            </div>
                            
                            {/* Reviews */}
                            {profile.reviews && profile.reviews.length > 0 && (() => {
                                const avgRating = profile.reviews.reduce((acc, r) => acc + r.rating, 0) / profile.reviews.length;
                                const firstReview = profile.reviews[0];

                                return (
                                    <div className="pt-3 border-t border-white/20">
                                        <div className="flex justify-between items-center mb-2">
                                            <StarRating rating={avgRating} />
                                            <p className="text-sm font-semibold text-gray-300">
                                                {avgRating.toFixed(1)} ({profile.reviews.length} reviews)
                                            </p>
                                        </div>
                                        <div className="bg-black/30 p-3 rounded-lg">
                                            <p className="text-sm text-gray-200 italic">"{firstReview.quote}"</p>
                                            <p className="text-sm text-right text-gray-400 mt-1">- {firstReview.reviewerName}</p>
                                        </div>
                                    </div>
                                );
                            })()}
                        </div>
                    </div>
                </div>
            );
        };
        const ChatList = ({ chats, selectedChatId, onSelectChat, onOpenCreateTeam }) => (<div className="w-full bg-white/5 backdrop-blur-xl flex flex-col h-full border-r border-white/10"><div className="p-4 border-b border-white/10 flex justify-between items-center"><h2 className="text-xl font-bold">Teams & DMs</h2><button onClick={onOpenCreateTeam} className="p-2 rounded-full hover:bg-white/20"><PlusIcon /></button></div><div className="flex-1 overflow-y-auto">{chats.sort((a,b) => b.lastMessage.timestamp - a.lastMessage.timestamp).map(chat => { const d = getChatDetails(chat, CURRENT_USER_ID); const isSel = chat.id === selectedChatId; const unread = chat.unreadCounts?.[CURRENT_USER_ID] || 0; const isTyping = Object.keys(chat.typing || {}).some(id => id !== CURRENT_USER_ID && chat.typing[id]); return (<div key={chat.id} onClick={() => onSelectChat(chat.id)} className={`flex items-center p-3 cursor-pointer ${isSel ? 'bg-blue-500/30' : 'hover:bg-white/10'}`}>{d.avatar}<div className="flex-1 ml-3"><p className={`font-semibold text-gray-100`}>{d.name}</p><p className={`text-sm truncate text-gray-300`}>{isTyping ? <span className="italic text-blue-400">typing...</span> : chat.lastMessage?.text}</p></div>{unread > 0 && <span className="bg-blue-500 text-white text-xs font-bold w-5 h-5 flex items-center justify-center rounded-full">{unread}</span>}</div>); })}</div></div>);
        const ChatWindow = ({ chat, messages, addMessage, onShowBoard, onBack }) => { 
            const ref = useRef(null); 
            const [newMessage, setNewMessage] = useState('');

            useEffect(() => { 
                ref.current?.scrollIntoView({ behavior: "smooth" }); 
            }, [messages]); 

            const handleSendMessage = (e) => {
                e.preventDefault();
                addMessage(newMessage);
                setNewMessage('');
            };

            const isBeginnerFriendly = useMemo(() => chat?.members.some(id => mockUsers[id]?.openToBeginners), [chat]); 
            
            if (!chat) {
                return (
                    <div className="hidden md:flex flex-1 flex-col items-center justify-center text-gray-400 bg-black/20">
                        <div className="text-center">
                            <MessageIcon />
                            <p className="mt-2 font-semibold">Select a conversation</p>
                            <p className="text-sm text-gray-500">Choose from your existing conversations to start chatting.</p>
                        </div>
                    </div>
                );
            }

            const d = getChatDetails(chat, CURRENT_USER_ID); 
            const otherUserId = chat?.type === 'private' ? chat?.members.find(id => id !== CURRENT_USER_ID) : null;
            const otherUserBadges = otherUserId ? (mockUsers[otherUserId]?.badges || []) : [];

            return (
                <div className="flex-1 flex flex-col h-full bg-black/20">
                    <div className="p-3 border-b border-white/10 bg-white/5 backdrop-blur-xl">
                        <div className="flex justify-between items-center">
                            <div className="flex items-center space-x-2">
                                <button onClick={onBack} className="md:hidden p-2 -ml-1 rounded-full hover:bg-white/10">
                                    <ChevronLeftIcon className="h-6 w-6"/>
                                </button>
                                <h3 className="text-lg font-bold">{d.name}</h3>
                                <div className="flex items-center space-x-1.5">
                                    {otherUserBadges.map(badge => (<div key={badge} className={`${badgeDetails[badge].color} opacity-70`} title={badge}>{React.cloneElement(badgeDetails[badge].icon, {width: 18, height: 18})}</div>))}
                                </div>
                            </div>
                            {chat.type === 'team' && (
                                <motion.button whileHover={{ scale: 1.05 }} whileTap={{ scale: 0.95 }} onClick={onShowBoard} className="flex items-center bg-indigo-600 px-3 py-2 rounded-xl text-sm font-semibold hover:bg-indigo-500 transition-colors shadow-[0_0_15px_rgba(129,140,248,0.3)] hover:shadow-[0_0_25px_rgba(129,140,248,0.5)]"> 
                                    <ViewBoardsIcon /> Team Board
                                </motion.button>
                            )}
                        </div>
                        <AnimatePresence>
                            {isBeginnerFriendly && chat.type !== 'community' && (
                                <motion.div initial={{ opacity: 0, height: 0, marginTop: 0 }} animate={{ opacity: 1, height: 'auto', marginTop: '0.75rem' }} exit={{ opacity: 0, height: 0, marginTop: 0 }} className="bg-green-500/20 border border-green-500 text-green-300 text-sm rounded-lg p-3">
                                    <p className="font-semibold">This team is beginner-friendly. Don’t hesitate to ask questions!</p>
                                </motion.div>
                            )}
                        </AnimatePresence>
                    </div>
                    <div className="flex-1 p-4 overflow-y-auto">
                        {messages.map((msg, i) => (
                            <div key={i} className={`flex ${msg.senderId === CURRENT_USER_ID ? 'justify-end' : 'justify-start'} mb-3`}>
                                <div className={`py-2 px-4 rounded-2xl max-w-sm md:max-w-md ${msg.senderId === CURRENT_USER_ID ? 'bg-blue-600 rounded-br-none' : 'bg-gray-700 rounded-bl-none'}`}>{msg.text}</div>
                            </div>
                        ))}
                        <div ref={ref} />
                    </div>
                    <form onSubmit={handleSendMessage} className="p-4 bg-white/5 backdrop-blur-xl border-t border-white/10">
                        <div className="relative">
                            <input 
                                type="text" 
                                placeholder="Type a message..." 
                                value={newMessage}
                                onChange={e => setNewMessage(e.target.value)}
                                className="w-full bg-gray-700/50 rounded-full py-3 px-5 pr-12 focus:outline-none focus:ring-2 focus:ring-purple-400" 
                            />
                            <button 
                                type="submit" 
                                className="absolute right-2 top-1/2 -translate-y-1/2 p-2 bg-purple-600 rounded-full hover:bg-purple-500 transition-colors disabled:bg-gray-600 disabled:cursor-not-allowed" 
                                disabled={!newMessage.trim()}
                            >
                                <PaperAirplaneIcon />
                            </button>
                        </div>
                    </form>
                </div>
            );
        };

        const dummyKanbanData = {
            cards: {
                'card-1': { id: 'card-1', content: 'Set up Firebase authentication & Firestore rules' },
                'card-2': { id: 'card-2', content: 'Design landing page & dashboard mockups in Figma' },
                'card-3': { id: 'card-3', content: 'Develop core matching algorithm v1' },
                'card-4': { id: 'card-4', content: 'Build out the swipeable card component' },
                'card-5': { id: 'card-5', content: 'Integrate chat functionality with Firestore' },
                'card-6': { id: 'card-6', content: 'Deploy initial build to Vercel/Netlify' },
                'card-7': { id: 'card-7', content: 'Test user onboarding flow' },
                'card-8': { id: 'card-8', content: 'Create presentation slides' },
            },
            columns: {
                'column-1': {
                    id: 'column-1',
                    title: 'Backlog',
                    cardIds: ['card-5', 'card-6', 'card-8'],
                },
                'column-2': {
                    id: 'column-2',
                    title: 'In Progress',
                    cardIds: ['card-2', 'card-4'],
                },
                'column-3': {
                    id: 'column-3',
                    title: 'In Review',
                    cardIds: ['card-3'],
                },
                'column-4': {
                    id: 'column-4',
                    title: 'Done',
                    cardIds: ['card-1', 'card-7'],
                },
            },
            columnOrder: ['column-1', 'column-2', 'column-3', 'column-4'],
        };

        const KanbanBoard = ({ onBackToChat }) => (<div className="flex-1 flex flex-col h-full bg-black/20 p-4"><div className="flex justify-between items-center mb-4"><h3 className="text-xl font-bold">Team Project Board</h3><motion.button whileHover={{ scale: 1.05 }} whileTap={{ scale: 0.95 }} onClick={onBackToChat} className="flex items-center bg-white/20 px-3 py-2 rounded-lg text-sm font-semibold hover:bg-white/30 transition-colors"><ChatAlt2Icon /> Back to Chat</motion.button></div><div className="flex-1 flex gap-4 overflow-x-auto">{dummyKanbanData.columnOrder.map(colId => (<div key={colId} className="bg-white/10 backdrop-blur-md border border-white/20 w-72 rounded-lg p-2 flex-shrink-0 flex flex-col"><h4 className="font-semibold p-2">{dummyKanbanData.columns[colId].title}</h4><div className="flex-1 p-1 space-y-2 overflow-y-auto">{dummyKanbanData.columns[colId].cardIds.map(cardId => (<div key={cardId} className="bg-gray-900/50 rounded-md p-3 text-sm">{dummyKanbanData.cards[cardId].content}</div>))}</div></div>))}</div></div>);
        const CreateTeamModal = ({ matches, onClose, onCreateTeam }) => { const [selectedMembers, setMembers] = useState([]); const [teamName, setTeamName] = useState(''); const canCreate = teamName.trim() && selectedMembers.length >= 2 && selectedMembers.length <= 4; return (<motion.div initial={{opacity:0}} animate={{opacity:1}} exit={{opacity:0}} className="fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-50 p-4"><motion.div initial={{scale:0.8}} animate={{scale:1}} exit={{scale:0.8}} className="bg-white/10 backdrop-blur-lg border border-white/20 rounded-xl w-full max-w-md shadow-2xl"><div className="p-4 flex justify-between items-center border-b border-white/20"><h2 className="text-lg font-bold">Create a New Team</h2><button onClick={onClose} className="p-1 rounded-full hover:bg-white/20"><XIcon /></button></div><div className="p-6 space-y-4"><div><label className="text-sm font-semibold text-gray-300 block mb-2">Team Name</label><input type="text" value={teamName} onChange={(e) => setTeamName(e.target.value)} placeholder="e.g., Project Phoenix" className="w-full bg-black/30 rounded-lg py-2 px-3 focus:outline-none focus:ring-2 focus:ring-purple-400" /></div><div><label className="text-sm font-semibold text-gray-300 block mb-2">Select Members (2-4)</label><div className="grid grid-cols-2 gap-3">{matches.map(m => { const isSel = selectedMembers.includes(m.id); return (<div key={m.id} onClick={() => setMembers(p => p.includes(m.id) ? p.filter(id => id !== m.id) : [...p, m.id])} className={`flex items-center p-2 rounded-lg cursor-pointer border-2 ${isSel ? 'border-purple-400 bg-purple-500/20' : 'border-transparent bg-black/30 hover:bg-black/50'}`}><img src={mockUsers[m.id].avatar} alt={mockUsers[m.id].name} className="h-8 w-8 rounded-full" /><span className="ml-2 text-sm font-semibold">{mockUsers[m.id].name}</span></div>)})}</div></div></div><div className="p-4 border-t border-white/20"><button onClick={() => onCreateTeam(teamName, selectedMembers)} disabled={!canCreate} className="w-full bg-purple-600 rounded-lg py-3 font-bold hover:bg-purple-500 disabled:bg-gray-600 disabled:cursor-not-allowed transition-colors shadow-[0_0_15px_rgba(192,132,252,0.3)] hover:shadow-[0_0_25px_rgba(192,132,252,0.5)]">Create Team ({selectedMembers.length + 1}/5)</button></div></motion.div></motion.div>) };
        const StatCard = ({ title, value, icon, color }) => (<div className={`bg-white/5 backdrop-blur-xl border border-white/10 p-6 rounded-xl flex items-center shadow-lg border-l-4 ${color}`}><div className="mr-4 text-3xl">{icon}</div><div><p className="text-3xl font-bold">{value}</p><p className="text-gray-300">{title}</p></div></div>);
        
        // --- AUTHENTICATION & MAIN VIEWS ---
        const LoginView = ({ onLoginSuccess, onSwitchToSignup, onBackToLanding }) => {
            const [email, setEmail] = useState('');
            const [password, setPassword] = useState('');
            const [error, setError] = useState('');

            const handleSubmit = (e) => {
                e.preventDefault();
                if (!email || !password) {
                    setError('Please fill in all fields.');
                    setTimeout(() => setError(''), 3000);
                    return;
                }
                // Mock login validation
                if (password.length < 6) {
                    setError('Password must be at least 6 characters.');
                    setTimeout(() => setError(''), 3000);
                    return;
                }
                setError('');
                onLoginSuccess();
            };

            return (
                <div className="relative w-full h-screen flex items-center justify-center p-4">
                    <button onClick={onBackToLanding} className="absolute top-4 left-4 flex items-center text-gray-300 hover:text-white transition-colors z-10">
                        <ChevronLeftIcon className="h-6 w-6" /> Back to Home
                    </button>
                    <motion.div 
                        initial={{ opacity: 0, y: -20 }}
                        animate={{ opacity: 1, y: 0 }}
                        transition={{ duration: 0.5 }}
                        className="w-full max-w-md"
                    >
                        <form onSubmit={handleSubmit} className="bg-white/10 backdrop-blur-xl border border-white/20 rounded-2xl shadow-2xl p-8 space-y-6">
                            <div className="text-center">
                                <h1 className="text-3xl font-bold">Welcome Back</h1>
                                <p className="text-gray-300">Login to find your team.</p>
                            </div>
                            
                            <AnimatePresence>
                                {error && (
                                    <motion.div
                                        initial={{ opacity: 0, y: -10, height: 0 }}
                                        animate={{ opacity: 1, y: 0, height: 'auto' }}
                                        exit={{ opacity: 0, y: -10, height: 0 }}
                                        className="bg-red-500/20 border border-red-500 text-red-300 text-sm font-semibold rounded-lg p-3 text-center"
                                    >
                                        {error}
                                    </motion.div>
                                )}
                            </AnimatePresence>

                            <div>
                                <label className="text-sm font-semibold text-gray-300 block mb-2">Email Address</label>
                                <input type="email" value={email} onChange={(e) => setEmail(e.target.value)} placeholder="you@example.com" className="w-full bg-black/30 rounded-lg py-3 px-4 focus:outline-none focus:ring-2 focus:ring-purple-400 transition" />
                            </div>
                            <div>
                                <label className="text-sm font-semibold text-gray-300 block mb-2">Password</label>
                                <input type="password" value={password} onChange={(e) => setPassword(e.target.value)} placeholder="••••••••" className="w-full bg-black/30 rounded-lg py-3 px-4 focus:outline-none focus:ring-2 focus:ring-purple-400 transition" />
                            </div>
                            <button type="submit" className="w-full bg-purple-600 rounded-lg py-3 font-bold hover:bg-purple-500 transition-colors shadow-[0_0_15px_rgba(192,132,252,0.3)] hover:shadow-[0_0_25px_rgba(192,132,252,0.5)]">Login</button>
                            <div className="text-center text-sm text-gray-400">
                                <p>Don't have an account? <button type="button" onClick={onSwitchToSignup} className="font-semibold text-purple-400 hover:underline">Sign Up</button></p>
                            </div>
                        </form>
                    </motion.div>
                </div>
            );
        };

        const SignupView = ({ onSignupSuccess, onSwitchToLogin, onBackToLanding }) => {
            return (
                <div className="relative w-full h-screen flex items-center justify-center p-4">
                    <button onClick={onBackToLanding} className="absolute top-4 left-4 flex items-center text-gray-300 hover:text-white transition-colors z-10">
                        <ChevronLeftIcon className="h-6 w-6" /> Back to Home
                    </button>
                    <motion.div 
                        initial={{ opacity: 0, y: 20 }}
                        animate={{ opacity: 1, y: 0 }}
                        transition={{ duration: 0.5 }}
                        className="w-full max-w-md bg-white/10 backdrop-blur-xl border border-white/20 rounded-2xl shadow-2xl p-8 space-y-6"
                    >
                        <div className="text-center">
                            <h1 className="text-3xl font-bold">Create Account</h1>
                            <p className="text-gray-300">Join HackMatch today!</p>
                        </div>
                        <p className="text-center text-gray-400 p-8 border-2 border-dashed border-gray-600 rounded-lg">
                            Sign-up form UI will be built here.
                        </p>
                        <button onClick={onSignupSuccess} className="w-full bg-green-600 rounded-lg py-3 font-bold hover:bg-green-500 transition-colors">Create Account (Placeholder)</button>
                        <div className="text-center text-sm text-gray-400">
                            <p>Already have an account? <button type="button" onClick={onSwitchToLogin} className="font-semibold text-purple-400 hover:underline">Login</button></p>
                        </div>
                    </motion.div>
                </div>
            );
        };

        const HeroView = ({ onLogin }) => (
            <div className="relative flex-1 w-full flex flex-col items-center justify-center text-center p-8 min-h-screen">
                <div className="max-w-6xl mx-auto">
                    <motion.h1 
                        initial={{ opacity: 0, y: -30 }} 
                        animate={{ opacity: 1, y: 0 }} 
                        transition={{ duration: 0.8, delay: 0.2, type: 'spring' }} 
                        className="text-5xl md:text-7xl lg:text-8xl font-black text-white mb-8 leading-tight"
                        style={{
                            background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
                            WebkitBackgroundClip: 'text',
                            WebkitTextFillColor: 'transparent',
                            backgroundClip: 'text',
                            textShadow: '0 0 30px rgba(102, 126, 234, 0.5)'
                        }}
                    >
                        Find Your Perfect<br />
                        <span className="text-4xl md:text-6xl lg:text-7xl">Hackathon Team</span>
                    </motion.h1>
                    
                    <motion.p 
                        initial={{ opacity: 0, y: 30 }} 
                        animate={{ opacity: 1, y: 0 }} 
                        transition={{ duration: 0.8, delay: 0.4, type: 'spring' }} 
                        className="text-xl md:text-2xl text-gray-200 max-w-4xl mx-auto mb-12 leading-relaxed font-light"
                    >
                        Stop searching, start building. Our AI-powered platform connects you with teammates who have the complementary skills and shared interests to bring your ideas to life.
                    </motion.p>
                    
                    <motion.div
                        initial={{ opacity: 0, scale: 0.8 }} 
                        animate={{ opacity: 1, scale: 1 }} 
                        transition={{ duration: 0.8, delay: 0.6, type: 'spring', stiffness: 150 }}
                        className="flex flex-col sm:flex-row gap-4 justify-center items-center"
                    >
                        <motion.button 
                            onClick={onLogin} 
                            className="relative group px-8 py-4 bg-gradient-to-r from-purple-600 to-blue-600 text-white rounded-full font-bold text-lg transition-all duration-300 hover:scale-105 hover:shadow-2xl"
                            whileHover={{ scale: 1.05 }}
                            whileTap={{ scale: 0.95 }}
                        >
                            <span className="absolute inset-0 bg-gradient-to-r from-purple-400 to-blue-400 rounded-full opacity-0 group-hover:opacity-100 transition-opacity duration-300"></span>
                            <span className="relative flex items-center space-x-2">
                                <span>Launch App</span>
                                <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 7l5 5m0 0l-5 5m5-5H6" />
                                </svg>
                            </span>
                        </motion.button>
                        
                        <motion.button 
                            className="px-8 py-4 border-2 border-white/30 text-white rounded-full font-semibold text-lg hover:bg-white/10 transition-all duration-300"
                            whileHover={{ scale: 1.05 }}
                            whileTap={{ scale: 0.95 }}
                        >
                            Learn More
                        </motion.button>
                    </motion.div>
                    
                    <motion.div
                        initial={{ opacity: 0, y: 50 }} 
                        animate={{ opacity: 1, y: 0 }} 
                        transition={{ duration: 0.8, delay: 0.8 }}
                        className="mt-16 grid grid-cols-1 md:grid-cols-3 gap-8 max-w-4xl mx-auto"
                    >
                        <div className="text-center p-6 bg-white/5 backdrop-blur-sm rounded-xl border border-white/10">
                            <div className="w-12 h-12 bg-blue-500/20 rounded-full flex items-center justify-center mx-auto mb-4">
                                <svg className="w-6 h-6 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 10V3L4 14h7v7l9-11h-7z" />
                                </svg>
                            </div>
                            <h3 className="text-lg font-bold text-white mb-2">AI-Powered Matching</h3>
                            <p className="text-gray-300 text-sm">Smart algorithms find teammates with complementary skills</p>
                        </div>
                        
                        <div className="text-center p-6 bg-white/5 backdrop-blur-sm rounded-xl border border-white/10">
                            <div className="w-12 h-12 bg-purple-500/20 rounded-full flex items-center justify-center mx-auto mb-4">
                                <svg className="w-6 h-6 text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
                                </svg>
                            </div>
                            <h3 className="text-lg font-bold text-white mb-2">Team Building</h3>
                            <p className="text-gray-300 text-sm">Connect with developers, designers, and mentors</p>
                        </div>
                        
                        <div className="text-center p-6 bg-white/5 backdrop-blur-sm rounded-xl border border-white/10">
                            <div className="w-12 h-12 bg-green-500/20 rounded-full flex items-center justify-center mx-auto mb-4">
                                <svg className="w-6 h-6 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                                </svg>
                            </div>
                            <h3 className="text-lg font-bold text-white mb-2">Instant Results</h3>
                            <p className="text-gray-300 text-sm">Find your perfect team in seconds, not hours</p>
                        </div>
                    </motion.div>
                </div>
            </div>
        );

        const DiscoverView = ({ awardBadge }) => {
            const { matches, loading } = useSmartMatches();
            const [profiles, setProfiles] = useState([]);
            const [matchCount, setMatchCount] = useState(0);
            const [currentIndex, setCurrentIndex] = useState(0);
            const [direction, setDirection] = useState(0);
            const [nextUserId, setNextUserId] = useState(allMockUsers.length + 2);
            
            // Fallback avatar function
            const getAvatarUrl = (originalUrl) => {
                if (!originalUrl) return 'https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?q=80&w=400&auto=format&fit=crop';
                return originalUrl;
            };

            useEffect(() => {
                if (!loading) {
                    setProfiles(matches);
                }
            }, [matches, loading]);

            const handleDecision = useCallback((decision, profileId) => {
                if (decision === 'accept') {
                    setMatchCount(mc => {
                        const newMatchCount = mc + 1;
                        if (newMatchCount === 3 && !mockUsers[CURRENT_USER_ID].badges.includes('Quick Match')) {
                            awardBadge('Quick Match');
                        }
                        return newMatchCount;
                    });
                }
                
                const newUser = generateSingleMockProfile(nextUserId);
                setNextUserId(prev => prev + 1);

                setProfiles(currentProfiles => {
                    const newProfiles = currentProfiles.filter(p => p.id !== profileId);
                    return [...newProfiles, newUser];
                });

            }, [awardBadge, nextUserId, profiles.length, currentIndex]);
            
            const paginate = (newDirection) => {
                if (!profiles.length) return;
                setDirection(newDirection);
                setCurrentIndex(prevIndex => {
                    const nextIndex = prevIndex + newDirection;
                    if (nextIndex < 0) {
                        return profiles.length - 1;
                    }
                    if (nextIndex >= profiles.length) {
                        return 0;
                    }
                    return nextIndex;
                });
            };
            
            const centerVariants = {
                enter: (direction) => ({
                    x: direction > 0 ? '100%' : '-100%',
                    opacity: 0,
                    scale: 0.8
                }),
                center: {
                    zIndex: 10,
                    x: 0,
                    opacity: 1,
                    scale: 1
                },
                exit: (direction) => ({
                    zIndex: 0,
                    x: direction < 0 ? '100%' : '-100%',
                    opacity: 0,
                    scale: 0.8,
                    transition: { duration: 0.2 }
                }),
            };

            const SideCard = ({ profile }) => (
                <div className="w-full h-full bg-white/5 backdrop-blur-xl border border-white/10 rounded-2xl shadow-2xl pointer-events-none">
                    <img src={profile.avatar} alt={profile.name} className="w-full h-full object-cover rounded-2xl" />
                    <div className="absolute inset-0 bg-black/40 rounded-2xl flex items-end p-4">
                        <h2 className="text-xl font-bold text-white truncate">{profile.name}</h2>
                    </div>
                </div>
            );
            
            const currentProfile = profiles[currentIndex];
            const prevProfile = profiles[((currentIndex - 1) + profiles.length) % profiles.length];
            const nextProfile = profiles[(currentIndex + 1) % profiles.length];

            return (
                <div className="flex-1 w-full flex flex-col items-center justify-center p-6 overflow-hidden bg-gradient-to-br from-gray-900 via-purple-900/20 to-blue-900/20">
                    <div className="text-center mb-8">
                        <h1 className="text-5xl md:text-6xl font-black mb-4 text-white drop-shadow-lg">
                            Find Your <span className="bg-gradient-to-r from-purple-400 to-blue-400 bg-clip-text text-transparent">Teammates</span>
                        </h1>
                        <p className="text-xl text-gray-300 mb-2 drop-shadow-sm">Drag to decide, or use arrows to browse.</p>
                    </div>

                    <div className="relative w-full max-w-6xl h-[75vh] max-h-[700px] flex items-center justify-center">
                        {/* Left Arrow */}
                        <motion.button 
                            whileHover={{ scale: 1.1 }} 
                            whileTap={{ scale: 0.9 }} 
                            onClick={() => paginate(-1)} 
                            className="absolute left-4 z-30 bg-white/20 backdrop-blur-md p-3 rounded-full flex items-center justify-center hover:bg-white/30 transition-colors border border-white/20 shadow-lg"
                        >
                            <ChevronLeftIcon className="h-6 w-6" />
                        </motion.button>
                        
                        {/* Right Arrow */}
                        <motion.button 
                            whileHover={{ scale: 1.1 }} 
                            whileTap={{ scale: 0.9 }} 
                            onClick={() => paginate(1)} 
                            className="absolute right-4 z-30 bg-white/20 backdrop-blur-md p-3 rounded-full flex items-center justify-center hover:bg-white/30 transition-colors border border-white/20 shadow-lg"
                        >
                            <ChevronRightIcon className="h-6 w-6" />
                        </motion.button>
                        
                        {/* Carousel Container */}
                        <div className="relative w-full h-full flex items-center justify-center">
                            {/* Previous Card (Left Edge) */}
                            <AnimatePresence>
                                {profiles.length > 1 && prevProfile && prevProfile.id !== currentProfile.id && (
                                    <motion.div 
                                        key={`prev-${prevProfile.id}`}
                                        initial={{ scale: 0.7, x: "-80%", opacity: 0 }} 
                                        animate={{ scale: 0.7, x: "-75%", opacity: 0.5 }} 
                                        exit={{ scale: 0.7, x: "-80%", opacity: 0 }} 
                                        transition={{ type: 'spring', stiffness: 200, damping: 25 }} 
                                        className="absolute w-full h-full top-0 left-0 filter blur-[4px] pointer-events-none"
                                    >
                                        <div className="w-full h-full bg-white/5 backdrop-blur-xl border border-white/10 rounded-2xl shadow-xl overflow-hidden">
                                            <div className="relative w-full h-full">
                                                <img 
                                                    src={getAvatarUrl(prevProfile.avatar)} 
                                                    alt={prevProfile.name}
                                                    className="w-full h-3/5 object-cover"
                                                    draggable="false" 
                                                />
                                                <div className="absolute bottom-0 left-0 right-0 p-4 bg-gradient-to-t from-black/90 via-black/70 to-transparent">
                                                    <h3 className="text-lg font-bold text-white truncate">{prevProfile.name}</h3>
                                                    <p className="text-gray-300 text-xs truncate">{prevProfile.bio}</p>
                                                </div>
                                            </div>
                                        </div>
                                    </motion.div>
                                )}
                            </AnimatePresence>
                            
                            {/* Current Card (Center) */}
                            <div className="relative w-full h-full max-w-sm z-20">
                                <AnimatePresence custom={direction} initial={false}>
                                    {loading ? (
                                        <div className="w-full h-full flex items-center justify-center bg-white/10 backdrop-blur-md rounded-xl">
                                            <h2 className="text-2xl font-bold animate-pulse">Finding Matches...</h2>
                                        </div>
                                    ) : currentProfile ? (
                                        <motion.div
                                            key={currentIndex}
                                            custom={direction}
                                            variants={centerVariants}
                                            initial="enter"
                                            animate="center"
                                            exit="exit"
                                            transition={{ x: { type: "spring", stiffness: 300, damping: 30 }, opacity: { duration: 0.2 } }}
                                            className="w-full h-full absolute top-0 left-0"
                                        >
                                            <SwipeableCard
                                                key={currentProfile.id}
                                                profile={currentProfile}
                                                onSwipe={handleDecision}
                                            />
                                        </motion.div>
                                    ) : (
                                        <div className="w-full h-full flex flex-col items-center justify-center text-center bg-white/10 backdrop-blur-md rounded-xl p-4">
                                            <h2 className="text-2xl font-bold">All Swiped!</h2>
                                            <p className="text-gray-300 mt-2">Check back later for new matches.</p>
                                        </div>
                                    )}
                                </AnimatePresence>
                            </div>
                            
                            {/* Next Card (Right Edge) */}
                            <AnimatePresence>
                                {profiles.length > 1 && nextProfile && nextProfile.id !== currentProfile.id && (
                                    <motion.div 
                                        key={`next-${nextProfile.id}`}
                                        initial={{ scale: 0.7, x: "80%", opacity: 0 }} 
                                        animate={{ scale: 0.7, x: "75%", opacity: 0.5 }} 
                                        exit={{ scale: 0.7, x: "80%", opacity: 0 }} 
                                        transition={{ type: 'spring', stiffness: 200, damping: 25 }} 
                                        className="absolute w-full h-full top-0 left-0 filter blur-[4px] pointer-events-none"
                                    >
                                        <div className="w-full h-full bg-white/5 backdrop-blur-xl border border-white/10 rounded-2xl shadow-xl overflow-hidden">
                                            <div className="relative w-full h-full">
                                                <img 
                                                    src={getAvatarUrl(nextProfile.avatar)} 
                                                    alt={nextProfile.name}
                                                    className="w-full h-3/5 object-cover"
                                                    draggable="false" 
                                                />
                                                <div className="absolute bottom-0 left-0 right-0 p-4 bg-gradient-to-t from-black/90 via-black/70 to-transparent">
                                                    <h3 className="text-lg font-bold text-white truncate">{nextProfile.name}</h3>
                                                    <p className="text-gray-300 text-xs truncate">{nextProfile.bio}</p>
                                                </div>
                                            </div>
                                        </div>
                                    </motion.div>
                                )}
                            </AnimatePresence>
                        </div>
                    </div>
                    
                </div>
            );
        };
        const ChatSystemView = () => {
            const [chats, setChats] = useState([
                { id: 'community-chat', type: 'community', name: 'Community Hub', members: [], lastMessage: { text: 'Welcome to the community!', timestamp: new Date() }, typing: {}, unreadCounts: { 'user1': 5 } },
                { id: 'team-chat-14', type: 'team', teamName: 'The Final Frontiers', members: ['user1', 'user58', 'user59'], lastMessage: { text: 'Let\'s finalize the presentation slides.', timestamp: new Date(Date.now() - 1200000) }, typing: {}, unreadCounts: { 'user1': 1 } },
                { id: 'chat1', type: 'private', members: ['user1', 'user2'], lastMessage: { text: 'Sounds good, let me know!', timestamp: new Date(Date.now() - 360000) }, typing: {}, unreadCounts: { 'user1': 2 } },
                { id: 'chat2', type: 'private', members: ['user1', 'user3'], lastMessage: { text: 'Perfect, I will start on the backend.', timestamp: new Date(Date.now() - 86400000) }, typing: { 'user3': true }, unreadCounts: { 'user1': 0 } },
            ]);
            
            const [allMessages, setAllMessages] = useState({
                'community-chat': [
                    { id: 'cmsg1', senderId: 'user5', text: "Has anyone worked with the new Vision Pro SDK?", timestamp: new Date(Date.now() - 7200000) },
                    { id: 'cmsg2', senderId: 'user10', text: 'Yeah, a little bit. It\'s pretty cool but has a steep learning curve.', timestamp: new Date(Date.now() - 7100000) },
                    { id: 'cmsg3', senderId: 'user22', text: 'I\'m looking for a designer for a HealthTech project! Ping me if interested.', timestamp: new Date(Date.now() - 6000000) },
                    { id: 'cmsg4', senderId: 'user1', text: 'Welcome to the community!', timestamp: new Date() },
                ],
                'team-chat-14': [
                    { id: 'tmsg1', senderId: 'user58', text: 'Hey team, I pushed the latest backend changes.', timestamp: new Date(Date.now() - 3600000) },
                    { id: 'tmsg2', senderId: 'user59', text: 'Great! I\'ll pull them and test the integration.', timestamp: new Date(Date.now() - 2400000) },
                    { id: 'tmsg3', senderId: 'user1', text: 'Let\'s finalize the presentation slides.', timestamp: new Date(Date.now() - 1200000) },
                ],
                'chat1': [
                    { id: 'msg1', senderId: 'user2', text: "Hey! Great to match...", timestamp: new Date(Date.now() - 720000) },
                    { id: 'msg2', senderId: 'user1', text: 'Thanks! Likewise...', timestamp: new Date(Date.now() - 600000) },
                    { id: 'msg3', senderId: 'user2', text: 'Sounds good, let me know!', timestamp: new Date(Date.now() - 360000) },
                ],
                'chat2': [
                    { id: 'msg4', senderId: 'user3', text: 'Perfect, I will start on the backend.', timestamp: new Date(Date.now() - 86400000) },
                ]
            });

            const [selChatId, setSelChatId] = useState(null);
            const [viewBoard, setViewBoard] = useState(false);
            const [showCreate, setShowCreate] = useState(false);
            
            const selChat = useMemo(() => chats.find(c => c.id === selChatId), [chats, selChatId]);
            const currentMessages = useMemo(() => allMessages[selChatId] || [], [allMessages, selChatId]);

            const addMessage = (text) => {
                if (!text.trim() || !selChatId) return;
                const newMessage = {
                    id: `msg-${Date.now()}`,
                    senderId: CURRENT_USER_ID,
                    text,
                    timestamp: new Date()
                };

                setAllMessages(prevAllMessages => ({
                    ...prevAllMessages,
                    [selChatId]: [...(prevAllMessages[selChatId] || []), newMessage]
                }));

                setChats(prevChats => prevChats.map(chat =>
                    chat.id === selChatId
                        ? { ...chat, lastMessage: { text: newMessage.text, timestamp: newMessage.timestamp } }
                        : chat
                ));
            };

            return (
                <div className="w-full h-full flex">
                    <AnimatePresence>
                        {showCreate && <CreateTeamModal matches={smartMatchesMock} onClose={() => setShowCreate(false)} onCreateTeam={() => {}} />}
                    </AnimatePresence>

                    <div className={`w-full h-full transition-all duration-300 ease-in-out md:w-1/3 lg:w-1/4 flex-shrink-0 ${selChatId ? 'hidden md:flex' : 'flex'}`}>
                        <ChatList 
                            chats={chats} 
                            selectedChatId={selChatId}
                            onSelectChat={setSelChatId} 
                            onOpenCreateTeam={() => setShowCreate(true)} 
                        />
                    </div>

                    <div className={`flex-1 h-full flex-col ${selChatId ? 'flex' : 'hidden md:flex'}`}>
                        {viewBoard ? (
                            <KanbanBoard onBackToChat={() => setViewBoard(false)} />
                        ) : (
                            <ChatWindow 
                                chat={selChat} 
                                messages={currentMessages} 
                                addMessage={addMessage}
                                onShowBoard={() => setViewBoard(true)} 
                                onBack={() => setSelChatId(null)} 
                            />
                        )}
                    </div>
                </div>
            );
        };
        const AdminDashboardView = () => {
            const usersWithoutTeam = allMockUsers.filter(u => !u.teamId).length;
            const teamlessPercent = Math.round((usersWithoutTeam / allMockUsers.length) * 100);
            
            // Static data for the visual charts
            const skillData = [
                { name: 'React', value: 40, color: '#0088FE' },
                { name: 'Python', value: 30, color: '#00C49F' },
                { name: 'Figma', value: 15, color: '#FFBB28' },
                { name: 'Node.js', value: 10, color: '#FF8042' },
                { name: 'Other', value: 5, color: '#AF19FF' },
            ];

            const interestData = [
                { name: 'AI/ML', value: 90 },
                { name: 'FinTech', value: 75 },
                { name: 'Social Good', value: 60 },
                { name: 'Web3', value: 45 },
                { name: 'Gaming', value: 30 },
            ];

            return (
            <div className="flex-1 w-full p-6 overflow-y-auto">
                <div className="mb-6">
                    <h1 className="text-3xl font-bold">Organizer Dashboard</h1>
                    <p className="text-purple-300">AI-Generated Hackathon Insights</p>
                </div>
                <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                    <StatCard title="Total Participants" value={allMockUsers.length} icon={<UsersIcon />} color="border-blue-500" />
                    <StatCard title="Active Teams" value={Object.keys(mockTeams).length} icon={<AwardIcon />} color="border-green-500" />
                    <StatCard title="Awaiting Teams" value={`${teamlessPercent}%`} icon={<UserPlusIcon />} color="border-yellow-500" />
                </div>

                <div className="grid grid-cols-1 lg:grid-cols-5 gap-6 mb-6">
                    <div className="lg:col-span-2 bg-white/5 backdrop-blur-xl border border-white/10 p-6 rounded-xl shadow-lg">
                        <h2 className="text-xl font-semibold mb-4 text-center">Skill Distribution</h2>
                        <div className="flex justify-center items-center my-4">
                            <div 
                                className="w-40 h-40 rounded-full flex items-center justify-center" 
                                style={{ background: `conic-gradient(#0088FE 0% 40%, #00C49F 40% 70%, #FFBB28 70% 85%, #FF8042 85% 95%, #AF19FF 95% 100%)` }}
                            >
                            <div className="w-24 h-24 bg-gray-800 rounded-full" />
                            </div>
                        </div>
                        <div className="space-y-2">
                            {skillData.map(item => (
                                <div key={item.name} className="flex items-center justify-between text-sm">
                                    <div className="flex items-center">
                                        <div className="w-3 h-3 rounded-full mr-2" style={{ backgroundColor: item.color }}></div>
                                        <span>{item.name}</span>
                                    </div>
                                    <span className="font-bold">{item.value}%</span>
                                </div>
                            ))}
                        </div>
                    </div>
                    <div className="lg:col-span-3 bg-white/5 backdrop-blur-xl border border-white/10 p-6 rounded-xl shadow-lg">
                        <h2 className="text-xl font-semibold mb-4 text-center">Popular Hackathon Themes</h2>
                        <div className="space-y-4">
                            {interestData.map(item => (
                                <div key={item.name} className="w-full">
                                    <div className="flex justify-between items-center mb-1 text-sm">
                                        <span className="font-semibold text-gray-300">{item.name}</span>
                                        <span className="text-gray-400">{item.value}% Interest</span>
                                    </div>
                                    <div className="w-full bg-gray-700 rounded-full h-2.5">
                                        <div className="bg-gradient-to-r from-green-400 to-blue-500 h-2.5 rounded-full" style={{ width: `${item.value}%` }}></div>
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>
                </div>
                
                <div className="bg-white/5 backdrop-blur-xl border border-white/10 p-6 rounded-xl shadow-lg">
                    <h2 className="text-xl font-semibold mb-4">AI-Powered Analysis</h2>
                    <div className="text-gray-300 space-y-2">
                        <p><strong className="text-purple-400">Insight:</strong> There's a high demand for developers with <strong className="text-green-400">React</strong> and <strong className="text-green-400">Python</strong> skills, but a lower supply of <strong className="text-yellow-400">UI/UX Designers</strong>. Consider running a design workshop to balance teams.</p>
                        <p><strong className="text-purple-400">Recommendation:</strong> The <strong className="text-blue-400">"AI/ML"</strong> theme is overwhelmingly popular. Promote cross-disciplinary teams by suggesting projects that merge AI with less popular themes like "Gaming" to foster innovation.</p>
                    </div>
                </div>
            </div>
            );
        };
        const ProfileView = ({ onHackathonEnd }) => { const [user, setUser] = useState(mockUsers[CURRENT_USER_ID]); const toggle = (key) => setUser(prev => ({ ...prev, [key]: !prev[key] })); return (<div className="flex-1 flex flex-col items-center p-4 overflow-y-auto w-full"><h1 className="text-3xl font-bold mb-6">Your Profile</h1><div className="bg-white/10 backdrop-blur-md border border-white/20 p-6 rounded-2xl shadow-xl w-full max-w-md text-gray-200 space-y-6"><div className="flex items-center space-x-4"><img src={user.avatar} alt="Profile" className="w-20 h-20 rounded-full border-2 border-purple-400" /><div><p className="text-2xl font-bold">{user.name}</p><p className="text-md text-gray-400">{user.experienceLevel}</p></div></div><div className="space-y-4 pt-4 border-t border-white/20"><h2 className="text-xl font-bold">Preferences</h2><div onClick={() => toggle('openToBeginners')} className="flex items-center justify-between cursor-pointer p-3 bg-black/30 rounded-lg"><div className="pr-4"><p className="font-semibold">Open to Beginners</p><p className="text-sm text-gray-400">Let others know you're happy to team up with newcomers.</p></div><div className={`w-14 h-8 flex items-center flex-shrink-0 rounded-full p-1 duration-300 ease-in-out ${user.openToBeginners ? 'bg-green-500' : 'bg-gray-700'}`}><motion.div layout className={`bg-white w-6 h-6 rounded-full shadow-md ${user.openToBeginners ? 'ml-6' : 'ml-0'}`} /></div></div><div onClick={() => toggle('lookingForMentor')} className="flex items-center justify-between cursor-pointer p-3 bg-black/30 rounded-lg"><div className="pr-4"><p className="font-semibold">Looking for a Mentor</p><p className="text-sm text-gray-400">Show a badge indicating you're seeking guidance.</p></div><div className={`w-14 h-8 flex items-center flex-shrink-0 rounded-full p-1 duration-300 ease-in-out ${user.lookingForMentor ? 'bg-blue-500' : 'bg-gray-700'}`}><motion.div layout className={`bg-white w-6 h-6 rounded-full shadow-md ${user.lookingForMentor ? 'ml-6' : 'ml-0'}`} /></div></div></div><div className="space-y-4 pt-4 border-t border-white/20"><h2 className="text-xl font-bold">Your Badges</h2><div className="grid grid-cols-1 sm:grid-cols-2 gap-4">{user.badges.length > 0 ? user.badges.map(badge => (<div key={badge} className="bg-black/30 p-4 rounded-lg flex items-center space-x-3"><div className={`w-10 h-10 flex-shrink-0 ${badgeDetails[badge].color}`}>{badgeDetails[badge].icon}</div><div><p className="font-semibold">{badge}</p><p className="text-xs text-gray-400">{badgeDetails[badge].description}</p></div></div>)) : <p className="text-gray-400 col-span-2">No badges earned yet. Start matching to unlock them!</p>}</div></div><div className="pt-4 border-t border-white/20"><button onClick={onHackathonEnd} className="w-full bg-red-600 text-white font-bold py-3 rounded-lg hover:bg-red-700 transition-colors shadow-[0_0_15px_rgba(239,68,68,0.3)] hover:shadow-[0_0_25px_rgba(239,68,68,0.5)]">Simulate Hackathon End</button></div></div></div>); };
        const PostHackathonView = ({ user, onStartNewHackathon }) => { const lastTeamId = user.teamId; const lastTeam = mockTeams[lastTeamId]; const teammates = lastTeam ? lastTeam.members.filter(id => id !== user.id).map(id => mockUsers[id]) : []; return (<motion.div initial={{opacity: 0, scale: 0.9}} animate={{opacity: 1, scale: 1}} className="flex-1 w-full flex flex-col items-center justify-center p-4 text-center"><div className="max-w-4xl w-full"><h1 className="text-4xl font-bold text-yellow-400 mb-2">Congratulations!</h1><p className="text-xl text-gray-300 mb-8">You've completed the hackathon. Let's keep the momentum going!</p><div className="grid md:grid-cols-2 gap-8"><div className="bg-white/10 backdrop-blur-md border border-white/20 p-6 rounded-2xl"><h2 className="text-2xl font-bold mb-4">Reconnect with Your Team</h2><p className="text-gray-400 mb-6">You built something great with "{lastTeam.name}". Why stop now?</p><div className="space-y-4 mb-6">{teammates.map(t => (<div key={t.name} className="flex items-center justify-between bg-black/30 p-3 rounded-lg"><div className="flex items-center space-x-3"><img src={t.avatar} className="w-12 h-12 rounded-full" alt={t.name}/><div><p className="font-semibold">{t.name}</p><p className="text-sm text-gray-400">{t.experienceLevel}</p></div></div><button className="flex items-center space-x-2 bg-blue-600 px-3 py-2 rounded-lg text-sm font-semibold hover:bg-blue-500 transition-colors shadow-[0_0_15px_rgba(59,130,246,0.3)] hover:shadow-[0_0_25px_rgba(59,130,246,0.5)]"><UserPlusIcon width={16} height={16} /><span>Follow</span></button></div>))}</div></div><div className="bg-white/10 backdrop-blur-md border border-white/20 p-6 rounded-2xl"><h2 className="text-2xl font-bold mb-4">Join Another Hackathon</h2><p className="text-gray-400 mb-6">Here are some upcoming events. Ready for another challenge?</p><div className="space-y-4">{mockUpcomingHackathons.map(h => (<div key={h.name} className="bg-black/30 p-4 rounded-lg text-left"><div className="flex justify-between items-start"><h3 className="font-bold text-lg">{h.name}</h3><span className="text-xs bg-indigo-500 px-2 py-1 rounded-full">{h.theme}</span></div><p className="text-sm text-gray-400 flex items-center space-x-2 mt-1 mb-4"><CalendarIcon width={14} height={14}/><span>{h.date}</span></p><button className="w-full bg-green-600 font-semibold py-2 rounded-lg hover:bg-green-500 transition-colors shadow-[0_0_15px_rgba(34,197,94,0.5)]">Rejoin Team for this</button></div>))}</div></div></div><button onClick={onStartNewHackathon} className="mt-8 text-gray-400 hover:text-white transition-colors">Or, start finding a new team</button></div></motion.div>); };


        // --- MAIN APP COMPONENT ---
        function App() {
            const [view, setView] = useState('landing');
            const [newlyAwardedBadge, setNewlyAwardedBadge] = useState(null);
            const [userRole] = useState('admin'); 
            const [hackathonEnded, setHackathonEnded] = useState(false);

            const awardBadge = useCallback((badgeName) => {
                if (!mockUsers[CURRENT_USER_ID].badges.includes(badgeName)) {
                    mockUsers[CURRENT_USER_ID].badges.push(badgeName);
                    setNewlyAwardedBadge(badgeName);
                    setTimeout(() => setNewlyAwardedBadge(null), 4000);
                }
            }, []);

            const currentUser = mockUsers[CURRENT_USER_ID];
            
            const Navbar = () => (<nav className="fixed w-full top-0 left-0 right-0 z-50 p-2"><div className="container mx-auto max-w-6xl flex justify-center items-center bg-white/10 backdrop-blur-md px-4 py-2 rounded-2xl border border-white/20"><div className="flex items-center space-x-2"><AwardIcon className="text-purple-400" /><span className="font-bold text-xl bg-gradient-to-r from-blue-400 to-purple-500 bg-clip-text text-transparent">HackMatch</span></div></div></nav>);
            
            const MainApp = () => {
                const [currentTab, setCurrentTab] = useState("home");

                const renderContent = () => {
                    if (hackathonEnded && currentUser.teamId) {
                        return <PostHackathonView user={currentUser} onStartNewHackathon={() => setHackathonEnded(false)} />
                    }
            
                    switch (currentTab) {
                        case "home": return <DiscoverView awardBadge={awardBadge} />;
                        case "profile": return <ProfileView onHackathonEnd={() => setHackathonEnded(true)} />;
                        case "messages": return <ChatSystemView />;
                        case "admin": return userRole === 'admin' ? <AdminDashboardView /> : <div className="text-center"><h1 className="text-2xl font-bold text-red-500">Access Denied</h1></div>;
                        default: return <DiscoverView awardBadge={awardBadge} />;
                    }
                };

                return (
                    <div className="w-full h-screen flex flex-col md:flex-row">
                        <AnimatePresence>{newlyAwardedBadge && (<><ConfettiExplosion /><BadgeToast badgeName={newlyAwardedBadge} /></>)}</AnimatePresence>

                        <aside className="hidden md:flex flex-col w-20 items-center py-8 space-y-6 bg-black/20 backdrop-blur-xl border-r border-white/10">
                            <div className="flex items-center justify-center h-10 w-10 rounded-lg bg-purple-600/80"><AwardIcon /></div>
                            <button onClick={() => setCurrentTab("home")} className={`p-3 rounded-lg transition ${currentTab === "home" ? 'bg-white/20 text-purple-400' : 'text-gray-400 hover:bg-white/10 hover:text-white'}`}><HomeIcon /></button>
                            <button onClick={() => setCurrentTab("messages")} className={`p-3 rounded-lg transition ${currentTab === "messages" ? 'bg-white/20 text-purple-400' : 'text-gray-400 hover:bg-white/10 hover:text-white'}`}><MessageIcon /></button>
                            <button onClick={() => setCurrentTab("profile")} className={`p-3 rounded-lg transition ${currentTab === "profile" ? 'bg-white/20 text-purple-400' : 'text-gray-400 hover:bg-white/10 hover:text-white'}`}><UserProfileIcon /></button>
                            {userRole === 'admin' && (<button onClick={() => setCurrentTab("admin")} className={`p-3 rounded-lg transition ${currentTab === "admin" ? 'bg-white/20 text-purple-400' : 'text-gray-400 hover:bg-white/10 hover:text-white'}`}><ShieldIcon /></button>)}
                        </aside>

                        <main className="flex-1 flex flex-col overflow-hidden">
                            {renderContent()}
                        </main>
                        
                        {!hackathonEnded && (
                            <footer className="h-[80px] md:hidden flex items-center justify-around p-4 bg-black/30 backdrop-blur-md border-t border-white/20">
                                <button onClick={() => setCurrentTab("home")} className={`flex flex-col items-center space-y-1 transition w-16 ${currentTab === "home" ? 'text-purple-400' : 'text-gray-300 hover:text-white'}`}><HomeIcon /><span className="text-xs">Discover</span></button>
                                <button onClick={() => setCurrentTab("messages")} className={`flex flex-col items-center space-y-1 transition w-16 ${currentTab === "messages" ? 'text-purple-400' : 'text-gray-300 hover:text-white'}`}><MessageIcon /><span className="text-xs">Messages</span></button>
                                <button onClick={() => setCurrentTab("profile")} className={`flex flex-col items-center space-y-1 transition w-16 ${currentTab === "profile" ? 'text-purple-400' : 'text-gray-300 hover:text-white'}`}><UserProfileIcon /><span className="text-xs">Profile</span></button>
                                {userRole === 'admin' && (<button onClick={() => setCurrentTab("admin")} className={`flex flex-col items-center space-y-1 transition w-16 ${currentTab === "admin" ? 'text-purple-400' : 'text-gray-300 hover:text-white'}`}><ShieldIcon /><span className="text-xs">Admin</span></button>)}
                            </footer>
                        )}
                    </div>
                );
            };

            const renderPage = () => {
                switch (view) {
                    case 'login':
                        return <LoginView onLoginSuccess={() => setView('app')} onSwitchToSignup={() => setView('signup')} onBackToLanding={() => setView('landing')} />;
                    case 'signup':
                        return <SignupView onSignupSuccess={() => setView('app')} onSwitchToLogin={() => setView('login')} onBackToLanding={() => setView('landing')} />;
                    case 'app':
                        return <MainApp />;
                    case 'landing':
                    default:
                        return (
                            <div className="relative w-full h-screen overflow-hidden">
                                <div className="absolute inset-0 animate-gradient-xy -z-10"></div>
                                <Navbar />
                                <HeroView onLogin={() => setView('login')} />
                            </div>
                        );
                }
            };

            return (
                <div className="bg-gray-900 text-white min-h-screen">
                    <AnimatePresence mode="wait">
                        <motion.div key={view} initial={{ opacity: 0 }} animate={{ opacity: 1 }} exit={{ opacity: 0 }} transition={{ duration: 0.3 }}>
                            {renderPage()}
                        </motion.div>
                    </AnimatePresence>
                </div>
            );
        }

        const container = document.getElementById('root');
        const root = ReactDOM.createRoot(container);
        root.render(<App />);
    </script>
</body>
</html>